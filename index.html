<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ–°æ€æƒ³å­¦ä¹ ç¤¾</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
html,body{background:#b81c1c;color:#fff;font-family:sans-serif;line-height:1.6;height:100%;}
.splash-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;animation:splashFade 2.5s ease forwards;animation-delay:3s;}
.ntlc-logo{display:flex;gap:12px;font-size:80px;font-weight:900;margin-bottom:40px;}
.ntlc-letter{opacity:0;transform:scale(0.5);animation:letterPop 0.6s ease forwards;}
.ntlc-letter:nth-child(1){color:#4285F4;animation-delay:0.2s;}
.ntlc-letter:nth-child(2){color:#EA4335;animation-delay:0.4s;}
.ntlc-letter:nth-child(3){color:#FBBC05;animation-delay:0.6s;}
.ntlc-letter:nth-child(4){color:#34A853;animation-delay:0.8s;}
@keyframes letterPop{0%{opacity:0;transform:scale(0.5);}70%{opacity:1;transform:scale(1.1);}100%{opacity:1;transform:scale(1);}}
@keyframes splashFade{0%{opacity:1;}100%{opacity:0;visibility:hidden;}}

.auth-modal,.pwd-modal,.reject-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(80,0,0,0.8);z-index:999;display:none;align-items:center;justify-content:center;}
.auth-box,.pwd-box,.reject-box{background:#801010;padding:30px;border-radius:12px;width:90%;max-width:420px;}
.modal-close{position:absolute;top:15px;right:15px;font-size:24px;color:#ffd700;cursor:pointer;}
.auth-tabs{display:flex;gap:10px;margin-bottom:20px;}
.auth-tab{flex:1;padding:12px;text-align:center;background:rgba(255,255,255,0.1);border-radius:8px;cursor:pointer;}
.auth-tab.active{background:#ffd700;color:#5a0000;font-weight:bold;}
.auth-input,.pwd-input,.reject-reason{width:100%;padding:14px;margin-bottom:12px;border-radius:8px;background:rgba(255,255,255,0.1);color:#fff;border:1px solid rgba(255,215,0,0.3);outline:none;}
.reject-reason{height:100px;resize:none;}
.auth-btn,.pwd-btn,.reject-btn{width:100%;padding:14px;border-radius:8px;background:#ffd700;color:#5a0000;font-weight:bold;border:none;cursor:pointer;}
.cancel-login{width:100%;margin-top:10px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.1);color:#ffd700;border:1px solid #ffd700;cursor:pointer;}

.main-app{display:none;}
.user-bar{background:#801010;padding:10px 15px;display:flex;justify-content:space-between;align-items:center;}
.avatar{width:32px;height:32px;border-radius:50%;border:2px solid #ffd700;}
.user-name{color:#ffd700;font-weight:bold;}
.logout{color:#fff;cursor:pointer;}

.search-bar{background:#801010;padding:8px 15px;text-align:center;}
.search-input{width:90%;max-width:400px;padding:10px 14px;border-radius:8px;background:rgba(255,255,255,0.1);color:#fff;border:1px solid #ffd70066;outline:none;}

.navbar{background:#801010;padding:12px;text-align:center;border-bottom:1px solid #ffd70033;}
.navbar h1{color:#fff;font-size:28px;margin-bottom:15px;}
.nav-links-first,.nav-links-second{display:flex;justify-content:center;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
.nav-link{color:#fff;padding:8px 16px;border-radius:8px;cursor:pointer;}
.nav-link.active{background:#ffd700;color:#801010;font-weight:bold;}

.container{max-width:800px;margin:0 auto;padding:15px 10px;}
.card{background:#801010;padding:20px;border-radius:12px;margin-bottom:15px;}
.card h3{color:#ffd700;text-align:center;margin-bottom:15px;}

.member-only{display:none;}
.has-account .member-only{display:inline-block;}

.article-item{padding:12px;border-bottom:1px solid rgba(255,255,255,0.1);margin-bottom:10px;}
.article-title{color:#ffd700;font-weight:bold;}
.article-meta{font-size:12px;color:#ccc;margin:4px 0;}
.article-content{margin:8px 0;line-height:1.6;}

/* ç‚¹èµè¯„è®ºæ ·å¼ */
.like-box{display:flex;align-items:center;gap:10px;margin:10px 0;}
.like-btn{background:#ffd700;color:#801010;border:none;border-radius:6px;padding:4px 10px;cursor:pointer;font-size:12px;}
.comment-item{background:rgba(255,255,255,0.05);padding:8px 10px;border-radius:6px;margin-bottom:6px;font-size:14px;}
.comment-user{color:#ffd700;font-weight:bold;font-size:12px;}
.comment-text{color:#eee;margin-top:2px;}
.comment-input-box{display:flex;gap:6px;margin-top:10px;}
.comment-input{flex:1;padding:8px;border-radius:6px;background:rgba(255,255,255,0.1);color:#fff;border:1px solid #ffd70055;}
.send-comment-btn{padding:0 12px;background:#ffd700;color:#801010;border:none;border-radius:6px;cursor:pointer;}

.btn{padding:6px 12px;border-radius:6px;border:none;cursor:pointer;font-weight:bold;margin-right:4px;}
.btn-sm{padding:4px 8px;font-size:12px;}
.btn-green{background:#28a050;color:#fff;}
.btn-red{background:#c81010;color:#fff;}
.btn-yellow{background:#ffc107;color:#222;}

.chat-layout{display:grid;grid-template-columns:200px 1fr;gap:12px;margin-top:10px;}
.chat-user-list{height:420px;overflow-y:auto;background:rgba(255,255,255,0.05);border-radius:8px;padding:8px;}
.chat-user-item{padding:8px;border-radius:6px;margin-bottom:6px;cursor:pointer;}
.chat-user-item.active{background:rgba(255,215,0,0.15);}
.unread-tag{background:red;color:#fff;font-size:10px;padding:1px 4px;border-radius:4px;}
.msg-area{flex:1;background:rgba(0,0,0,0.15);border-radius:8px;padding:10px;overflow-y:auto;}
.msg-input-area{display:flex;gap:6px;}
.msg-input{flex:1;padding:10px;border-radius:8px;background:rgba(255,255,255,0.1);color:#fff;border:1px solid #ffd70055;}
.send-btn{padding:0 16px;background:#ffd700;color:#801010;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
.msg-item{max-width:75%;margin-bottom:10px;padding:8px 12px;border-radius:12px;}
.msg-me{margin-left:auto;background:#ffd700;color:#5a0000;}
.msg-other{margin-right:auto;background:rgba(255,255,255,0.1);color:#fff;}
</style>
</head>
<body>

<div class="splash-screen">
  <div class="ntlc-logo">
    <span class="ntlc-letter">N</span>
    <span class="ntlc-letter">T</span>
    <span class="ntlc-letter">L</span>
    <span class="ntlc-letter">C</span>
  </div>
  <p style="color:#666;">æ–°æ€æƒ³å­¦ä¹ ç¤¾</p>
</div>

<div class="auth-modal" id="authModal">
  <div class="auth-box">
    <span class="modal-close" onclick="closeAuth()">Ã—</span>
    <div class="auth-tabs">
      <div class="auth-tab active" data-mode="login">ç™»å½•</div>
      <div class="auth-tab" data-mode="reg">æ³¨å†Œ</div>
    </div>
    <div id="loginForm">
      <input class="auth-input" id="loginAcc" placeholder="è´¦å·">
      <input class="auth-input" id="loginPwd" type="password" placeholder="å¯†ç ">
      <button class="auth-btn" onclick="doLogin()">ç™»å½•</button>
    </div>
    <div id="regForm" style="display:none;">
      <input class="auth-input" id="regAcc" placeholder="è´¦å·">
      <input class="auth-input" id="regPwd" type="password" placeholder="å¯†ç ">
      <input class="auth-input" id="regNick" placeholder="æ˜µç§°">
      <button class="auth-btn" onclick="doReg()">æ³¨å†Œ</button>
    </div>
    <button class="cancel-login" onclick="closeAuth()">æ¸¸å®¢æµè§ˆ</button>
  </div>
</div>

<div class="pwd-modal" id="managePwdModal">
  <div class="pwd-box">
    <span class="modal-close" onclick="closePwdModal()">Ã—</span>
    <h3 style="color:#ffd700;text-align:center;">ç®¡ç†å¯†ç </h3>
    <input class="pwd-input" id="managePwd" type="password" placeholder="è¾“å…¥ç®¡ç†å¯†ç ">
    <button class="pwd-btn" onclick="checkManagePwd()">ç¡®è®¤è¿›å…¥</button>
  </div>
</div>

<div class="reject-modal" id="rejectModal">
  <div class="reject-box">
    <span class="modal-close" onclick="closeRejectModal()">Ã—</span>
    <h3 style="color:#ffd700;text-align:center;">é©³å›ç†ç”±</h3>
    <textarea class="reject-reason" id="reasonInput"></textarea>
    <button class="reject-btn" onclick="confirmReject()">æäº¤</button>
  </div>
</div>

<div class="main-app" id="mainApp">
  <div class="user-bar">
    <div class="user-info">
      <img src="https://picsum.photos/80/80" class="avatar">
      <span class="user-name" id="nickBar"></span>
    </div>
    <span class="logout" onclick="logout()">é€€å‡ºç™»å½•</span>
  </div>

  <div class="search-bar">
    <input class="search-input" id="searchInput" placeholder="æœç´¢ç”¨æˆ·ï¼ˆæ˜µç§°/è´¦å·ï¼‰" oninput="doSearch()">
  </div>

  <div class="navbar">
    <h1>æ–°æ€æƒ³å­¦ä¹ ç¤¾</h1>
    <div class="nav-links-first">
      <span class="nav-link active" onclick="go('home')">é¦–é¡µ</span>
      <span class="nav-link" onclick="go('article')">æœ€æ–°æ–‡ç« </span>
      <span class="nav-link member-only" onclick="go('publish')">å‘å¸ƒæ–‡ç« </span>
      <span class="nav-link member-only" onclick="go('usercenter')">ä¸ªäººä¸­å¿ƒ</span>
      <span class="nav-link member-only" onclick="go('chat')">ç§èŠ</span>
    </div>
    <div class="nav-links-second">
      <span class="nav-link member-only" onclick="go('voice')">è¯­éŸ³ä¼šè®®</span>
      <span class="nav-link" onclick="go('userlist')">ç”¨æˆ·åˆ—è¡¨</span>
      <span class="nav-link" onclick="openManagePwd()">ç®¡ç†ä¸­å¿ƒ</span>
    </div>
  </div>

  <div class="container">
    <!-- é¦–é¡µ -->
    <div id="home" class="card"><h3>é¦–é¡µ</h3><p>å·²æ–°å¢ï¼šæ–‡ç« ç‚¹èµè¯„è®ºã€ä¸ªäººä¸­å¿ƒã€ç®¡ç†åˆ æ–‡ç« </p></div>

    <!-- æœ€æ–°æ–‡ç« ï¼ˆå¸¦ç‚¹èµè¯„è®ºï¼‰ -->
    <div id="article" class="card" style="display:none;"><h3>å·²é€šè¿‡æ–‡ç« </h3><div id="articleList"></div></div>

    <!-- å‘å¸ƒæ–‡ç«  -->
    <div id="publish" class="card" style="display:none;"><h3>å‘å¸ƒæ–‡ç« </h3><input class="auth-input" id="artTitle" placeholder="æ ‡é¢˜"><textarea class="auth-input" rows="7" id="artContent" placeholder="å†…å®¹"></textarea><button class="auth-btn" onclick="publishArt()">æäº¤</button></div>

    <!-- ä¸ªäººä¸­å¿ƒï¼ˆæ–°å¢ï¼‰ -->
    <div id="usercenter" class="card" style="display:none;">
      <h3>ä¸ªäººä¸­å¿ƒ</h3>
      <div style="margin-bottom:20px;">
        <label>å½“å‰æ˜µç§°ï¼š</label>
        <input class="auth-input" id="editNick" placeholder="è¾“å…¥æ–°æ˜µç§°">
        <button class="auth-btn" onclick="saveNick()">ä¿å­˜ä¿®æ”¹</button>
      </div>
      <div>
        <h4 style="color:#ffd700;margin-bottom:10px;">æˆ‘çš„æ–‡ç« </h4>
        <div id="myArticleList"></div>
      </div>
    </div>

    <!-- ç§èŠ -->
    <div id="chat" class="card" style="display:none;"><h3>ç§èŠ</h3><div class="chat-layout"><div class="chat-user-list" id="chatUserList"></div><div class="chat-box"><div class="msg-area" id="msgArea"></div><div class="msg-input-area"><input class="msg-input" id="msgInput" onkeydown="event.key==='Enter'&&sendMsg()"><button class="send-btn" onclick="sendMsg()">å‘é€</button></div></div></div></div>

    <!-- è¯­éŸ³ -->
    <div id="voice" class="card" style="display:none;"><h3>è¯­éŸ³ä¼šè®®</h3><p>åŠŸèƒ½å·²ä¿ç•™</p></div>

    <!-- ç”¨æˆ·åˆ—è¡¨ -->
    <div id="userlist" class="card" style="display:none;"><h3>ç”¨æˆ·åˆ—è¡¨</h3><div id="searchResult"></div></div>

    <!-- ç®¡ç†ä¸­å¿ƒï¼ˆæ–°å¢åˆ é™¤æ–‡ç« ï¼‰ -->
    <div id="manage" class="card" style="display:none;">
      <h3>ç®¡ç†ä¸­å¿ƒ</h3>
      <div style="margin-bottom:20px;">
        <h4 style="color:#ffd700;">æ–‡ç« å®¡æ ¸ä¸åˆ é™¤</h4>
        <div id="auditList"></div>
      </div>
      <hr style="margin:20px 0;border-color:#ffd70033;">
      <div>
        <h4 style="color:#ffd700;">ç”¨æˆ·å°å·ç®¡ç†</h4>
        <div id="banUserList"></div>
      </div>
    </div>
  </div>
</div>

<script>
const STORAGE = {
  users:"ntlc_users", cur:"ntlc_cur",
  arts:"ntlc_arts", chats:"ntlc_chats",
  likes:"ntlc_likes", comments:"ntlc_comments"
};
const MANAGE_PWD = "159357258";

let users = JSON.parse(localStorage.getItem(STORAGE.users) || "[]");
let cur = JSON.parse(localStorage.getItem(STORAGE.cur) || null);
let arts = JSON.parse(localStorage.getItem(STORAGE.arts) || "[]");
let chats = JSON.parse(localStorage.getItem(STORAGE.chats) || "[]");
let likes = JSON.parse(localStorage.getItem(STORAGE.likes) || "[]");
let comments = JSON.parse(localStorage.getItem(STORAGE.comments) || "[]");

let currentRejectId = null;
let chatTo = null;
let showArtId = null;

setTimeout(() => {
  cur ? closeAuth() : (document.getElementById("authModal").style.display = "flex");
}, 4500);

document.querySelectorAll(".auth-tab").forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll(".auth-tab").forEach(x => x.classList.remove("active"));
    tab.classList.add("active");
    const m = tab.dataset.mode;
    document.getElementById("loginForm").style.display = m === "login" ? "block" : "none";
    document.getElementById("regForm").style.display = m === "reg" ? "block" : "none";
  };
});

function closeAuth() {
  document.getElementById("authModal").style.display = "none";
  document.getElementById("mainApp").style.display = "block";
  if (!cur) {
    document.getElementById("nickBar").innerText = "æ¸¸å®¢";
    return;
  }
  document.getElementById("mainApp").classList.add("has-account");
  document.getElementById("nickBar").innerText = cur.nick;
}

function doReg() {
  const acc = document.getElementById("regAcc").value.trim();
  const pwd = document.getElementById("regPwd").value.trim();
  const nick = document.getElementById("regNick").value.trim();
  if (!acc || !pwd || !nick) return alert("è¯·å¡«å®Œæ•´");
  if (users.some(u => u.account === acc)) return alert("è´¦å·å·²å­˜åœ¨");
  const user = { uid: "u"+Date.now(), account: acc, pwd: pwd, nick: nick, status: "normal" };
  users.push(user);
  localStorage.setItem(STORAGE.users, JSON.stringify(users));
  alert("æ³¨å†ŒæˆåŠŸ");
  document.querySelector(".auth-tab[data-mode='login']").click();
}

function doLogin() {
  const acc = document.getElementById("loginAcc").value.trim();
  const pwd = document.getElementById("loginPwd").value.trim();
  const u = users.find(x => x.account === acc && x.pwd === pwd);
  if (!u) return alert("è´¦å·æˆ–å¯†ç é”™è¯¯");
  if (u.status === "ban") return alert("è´¦å·å·²å°ç¦");
  cur = u;
  localStorage.setItem(STORAGE.cur, JSON.stringify(cur));
  closeAuth();
}

function go(page) {
  document.querySelectorAll(".card").forEach(c => c.style.display = "none");
  document.getElementById(page).style.display = "block";
  document.querySelectorAll(".nav-link").forEach(n => n.classList.remove("active"));
  const el = document.querySelector(`.nav-link[onclick*="${page}"]`);
  if (el) el.classList.add("active");
  if (page === "article") renderArticles();
  if (page === "chat") loadChatUsers();
  if (page === "manage") renderManageCenter();
  if (page === "userlist") renderAllUsers();
  if (page === "usercenter") renderUserCenter();
}

// ========== æœç´¢ ==========
function doSearch() {
  const kw = document.getElementById("searchInput").value.trim().toLowerCase();
  go("userlist");
  const list = users.filter(u => {
    if (cur && u.uid === cur.uid) return false;
    return u.nick.toLowerCase().includes(kw) || u.account.toLowerCase().includes(kw);
  });
  const dom = document.getElementById("searchResult");
  dom.innerHTML = list.length ? list.map(u => `
    <div style='padding:10px;border-bottom:1px solid rgba(255,255,255,0.1);'>
      <div style='color:#ffd700;font-weight:bold;'>${u.nick}</div>
      <div style='font-size:12px;color:#ccc;'>è´¦å·ï¼š${u.account}ï½œ${u.status}</div>
      <button class='btn btn-sm btn-yellow' onclick='openChat("${u.uid}","${u.nick}")'>ç§èŠ</button>
    </div>
  `).join("") : "<p style='text-align:center;color:#ccc;'>æ— åŒ¹é…ç”¨æˆ·</p>";
}
function renderAllUsers() { doSearch(); }

// ========== ç®¡ç†å¯†ç  ==========
function openManagePwd() { document.getElementById("managePwdModal").style.display = "flex"; }
function closePwdModal() { document.getElementById("managePwdModal").style.display = "none"; }
function checkManagePwd() {
  if (document.getElementById("managePwd").value === MANAGE_PWD) {
    closePwdModal(); go("manage");
  } else alert("å¯†ç é”™è¯¯");
}

// ========== æ–‡ç« å‘å¸ƒ ==========
function publishArt() {
  if (!cur) return alert("è¯·ç™»å½•");
  const t = document.getElementById("artTitle").value.trim();
  const c = document.getElementById("artContent").value.trim();
  if (!t || !c) return alert("ä¸èƒ½ä¸ºç©º");
  arts.unshift({
    id: "a"+Date.now(), title: t, content: c,
    uid: cur.uid, nick: cur.nick, status: "pending",
    time: new Date().toLocaleString()
  });
  localStorage.setItem(STORAGE.arts, JSON.stringify(arts));
  alert("æäº¤å¾…å®¡æ ¸");
  go("article");
}

// ========== ç‚¹èµé€»è¾‘ ==========
function toggleLike(aid) {
  if (!cur) return alert("è¯·ç™»å½•åç‚¹èµ");
  const idx = likes.findIndex(x => x.aid === aid && x.uid === cur.uid);
  if (idx > -1) likes.splice(idx, 1);
  else likes.push({ aid: aid, uid: cur.uid });
  localStorage.setItem(STORAGE.likes, JSON.stringify(likes));
  renderArticles();
}

// ========== è¯„è®º ==========
function sendComment(aid) {
  if (!cur) return alert("è¯·ç™»å½•åè¯„è®º");
  const inp = document.getElementById(`comment_${aid}`);
  const txt = inp.value.trim();
  if (!txt) return;
  comments.push({
    cid: "c"+Date.now(), aid: aid,
    uid: cur.uid, nick: cur.nick,
    content: txt, time: new Date().toLocaleString()
  });
  localStorage.setItem(STORAGE.comments, JSON.stringify(comments));
  inp.value = "";
  renderArticles();
}

// ========== æ–‡ç« åˆ—è¡¨ï¼ˆç‚¹èµ+è¯„è®ºå±•ç¤ºï¼‰ ==========
function renderArticles() {
  const pass = arts.filter(a => a.status === "pass");
  const html = pass.length ? pass.map(a => {
    const likeCnt = likes.filter(x => x.aid === a.id).length;
    const myLike = cur && likes.some(x => x.aid === a.id && x.uid === cur.uid);
    const cmts = comments.filter(x => x.aid === a.id);
    return `
    <div class="article-item">
      <div class="article-title">${a.title}</div>
      <div class="article-meta">${a.nick}ï½œ${a.time}</div>
      <div class="article-content">${a.content}</div>
      <div class="like-box">
        <button class="like-btn" onclick="toggleLike('${a.id}')">
          ${myLike ? 'â¤ï¸å·²ç‚¹èµ' : 'ğŸ¤ç‚¹èµ'} (${likeCnt})
        </button>
        <span>è¯„è®º(${cmts.length})</span>
      </div>
      <div style="margin-top:10px;">
        ${cmts.map(c => `
        <div class="comment-item">
          <div class="comment-user">${c.nick}ï½œ${c.time}</div>
          <div class="comment-text">${c.content}</div>
        </div>`).join("")}
        <div class="comment-input-box member-only">
          <input class="comment-input" id="comment_${a.id}" placeholder="å†™è¯„è®ºâ€¦">
          <button class="send-comment-btn" onclick="sendComment('${a.id}')">å‘é€</button>
        </div>
      </div>
    </div>`;
  }).join("") : "<p style='text-align:center;color:#ccc;'>æš‚æ— å·²é€šè¿‡æ–‡ç« </p>";
  document.getElementById("articleList").innerHTML = html;
}

// ========== å®¡æ ¸é©³å› ==========
function openRejectModal(id) { currentRejectId = id; document.getElementById("rejectModal").style.display = "flex"; }
function closeRejectModal() { document.getElementById("rejectModal").style.display = "none"; }
function confirmReject() {
  const r = document.getElementById("reasonInput").value.trim();
  if (!r) return alert("è¯·å†™ç†ç”±");
  const a = arts.find(x => x.id === currentRejectId);
  a.status = "reject";
  localStorage.setItem(STORAGE.arts, JSON.stringify(arts));
  closeRejectModal(); renderManageCenter();
}
function passArticle(id) {
  const a = arts.find(x => x.id === id);
  a.status = "pass";
  localStorage.setItem(STORAGE.arts, JSON.stringify(arts));
  renderManageCenter();
}

// ========== ç®¡ç†ï¼šåˆ é™¤æ–‡ç« ï¼ˆæ–°å¢ï¼‰ ==========
function deleteArticle(aid) {
  if (!confirm("ç¡®å®šåˆ é™¤è¯¥æ–‡ç« ï¼Ÿæ‰€æœ‰è¯„è®ºç‚¹èµéƒ½ä¼šæ¸…ç©ºï¼")) return;
  arts = arts.filter(x => x.id !== aid);
  comments = comments.filter(x => x.aid !== aid);
  likes = likes.filter(x => x.aid !== aid);
  localStorage.setItem(STORAGE.arts, JSON.stringify(arts));
  localStorage.setItem(STORAGE.comments, JSON.stringify(comments));
  localStorage.setItem(STORAGE.likes, JSON.stringify(likes));
  renderManageCenter();
}

// ========== å°å· ==========
function toggleBan(uid) {
  const u = users.find(x => x.uid === uid);
  u.status = u.status === "normal" ? "ban" : "normal";
  localStorage.setItem(STORAGE.users, JSON.stringify(users));
  renderManageCenter();
}

// ========== ç®¡ç†ä¸­å¿ƒæ¸²æŸ“ï¼ˆåŠ åˆ é™¤æŒ‰é’®ï¼‰ ==========
function renderManageCenter() {
  document.getElementById("auditList").innerHTML = arts.map(a => `
    <div style='padding:10px;border-bottom:1px solid #fff2;'>
      <div style='color:#ffd700;'>${a.title} [${a.status}]</div>
      <div style='font-size:12px;color:#ccc;'>${a.nick}ï½œ${a.time}</div>
      <div style='margin-top:6px;display:flex;gap:6px;'>
        ${a.status==="pending" ? `
        <button class='btn btn-sm btn-green' onclick='passArticle("${a.id}")'>é€šè¿‡</button>
        <button class='btn btn-sm btn-yellow' onclick='openRejectModal("${a.id}")'>é©³å›</button>` : ""}
        <button class='btn btn-sm btn-red' onclick='deleteArticle("${a.id}")'>åˆ é™¤æ–‡ç« </button>
      </div>
    </div>
  `).join("") || "<p style='text-align:center;color:#ccc;'>æ— æ–‡ç« </p>";

  document.getElementById("banUserList").innerHTML = users.map(u => `
    <div style='padding:10px;border-bottom:1px solid #fff2;display:flex;justify-content:space-between;'>
      <div>${u.nick}ï¼ˆ${u.status}ï¼‰</div>
      <button class='btn btn-sm ${u.status==="normal"?"btn-red":"btn-green"}' onclick='toggleBan("${u.uid}")'>
        ${u.status==="normal"?"å°ç¦":"è§£å°"}
      </button>
    </div>
  `).join("");
}

// ========== ä¸ªäººä¸­å¿ƒï¼ˆæ–°å¢ï¼‰ ==========
function renderUserCenter() {
  if (!cur) return;
  document.getElementById("editNick").value = cur.nick;
  const myArts = arts.filter(a => a.uid === cur.uid);
  document.getElementById("myArticleList").innerHTML = myArts.length ? myArts.map(a => `
    <div style='padding:8px;border-bottom:1px solid #fff2;'>
      <div style='color:#ffd700;'>${a.title} [${a.status}]</div>
      <div style='font-size:12px;color:#ccc;'>${a.time}</div>
    </div>
  `).join("") : "<p style='color:#ccc;'>ä½ è¿˜æœªå‘å¸ƒæ–‡ç« </p>";
}
function saveNick() {
  if (!cur) return;
  const newNick = document.getElementById("editNick").value.trim();
  if (!newNick) return alert("æ˜µç§°ä¸èƒ½ä¸ºç©º");
  cur.nick = newNick;
  const u = users.find(x => x.uid === cur.uid);
  u.nick = newNick;
  // åŒæ­¥æ–‡ç« æ˜µç§°
  arts.forEach(a => { if(a.uid === cur.uid) a.nick = newNick; });
  comments.forEach(c => { if(c.uid === cur.uid) c.nick = newNick; });
  localStorage.setItem(STORAGE.cur, JSON.stringify(cur));
  localStorage.setItem(STORAGE.users, JSON.stringify(users));
  localStorage.setItem(STORAGE.arts, JSON.stringify(arts));
  localStorage.setItem(STORAGE.comments, JSON.stringify(comments));
  document.getElementById("nickBar").innerText = newNick;
  alert("æ˜µç§°ä¿®æ”¹æˆåŠŸ");
  renderUserCenter();
}

// ========== ç§èŠ ==========
function loadChatUsers() {
  const list = users.filter(u => !cur || u.uid !== cur.uid);
  document.getElementById("chatUserList").innerHTML = list.map(u => `
    <div class="chat-user-item" onclick="openChat('${u.uid}','${u.nick}')">${u.nick}</div>
  `).join("");
}
function openChat(uid, nick) { chatTo = uid; }
function sendMsg() {
  if (!chatTo || !cur) return;
  const t = document.getElementById("msgInput").value.trim();
  if (!t) return;
  chats.push({ from: cur.uid, to: chatTo, text: t, time: new Date().toLocaleString() });
  localStorage.setItem(STORAGE.chats, JSON.stringify(chats));
  document.getElementById("msgInput").value = "";
  alert("æ¶ˆæ¯å·²å‘é€");
}

function logout() {
  cur = null;
  localStorage.removeItem(STORAGE.cur);
  location.reload();
}
</script>
</body>
</html>
